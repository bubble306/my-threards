<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echo's Threads - ä¸ªäººç¤¾åŒº</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #1d9bf0; --bg: #f7f9f9; --text: #0f1419; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 50px; }
        nav { background: white; padding: 15px; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #eff3f4; text-align: center; font-weight: bold; font-size: 1.2rem; }
        .container { max-width: 600px; margin: 0 auto; }
        
        /* å‘å¸ƒåŒºåŸŸ */
        .input-box { background: white; padding: 15px; border-bottom: 1px solid #eff3f4; }
        textarea { width: 100%; border: none; font-size: 18px; outline: none; resize: none; min-height: 100px; }
        .input-footer { display: flex; justify-content: space-between; align-items: center; padding-top: 10px; border-top: 1px solid #f2f2f2; }
        input[type="text"] { border: 1px solid #eee; padding: 5px 10px; border-radius: 20px; outline: none; }
        #sendBtn { background: var(--primary); color: white; border: none; padding: 8px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; }
        #sendBtn:disabled { opacity: 0.5; }

        /* åŠ¨æ€åˆ—è¡¨ */
        .post { background: white; padding: 15px; border-bottom: 1px solid #eff3f4; transition: 0.2s; }
        .post:hover { background: #fdfdfd; }
        .post-header { display: flex; align-items: center; margin-bottom: 5px; }
        .nickname { font-weight: bold; color: var(--primary); cursor: pointer; text-decoration: none; }
        .time { color: #536471; font-size: 13px; margin-left: 10px; }
        .content { font-size: 15px; line-height: 1.5; white-space: pre-wrap; margin: 10px 0; }
        
        /* äº¤äº’åŒº */
        .actions { display: flex; gap: 30px; color: #536471; font-size: 14px; }
        .action-btn { cursor: pointer; display: flex; align-items: center; gap: 5px; transition: 0.2s; }
        .action-btn:hover { color: var(--primary); }

        /* è¯„è®ºåŒº */
        .comments-section { background: #f8f9fa; border-radius: 8px; margin-top: 10px; padding: 10px; font-size: 13px; }
        .comment-item { margin-bottom: 5px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .comment-input-wrap { display: flex; gap: 5px; margin-top: 10px; }
        .comment-input { flex: 1; border: 1px solid #ddd; border-radius: 15px; padding: 5px 12px; outline: none; }

        /* ä¸ªäººä¸»é¡µè§†å›¾ */
        #profile-view { display: none; padding: 20px; background: white; margin-bottom: 10px; border-radius: 0 0 15px 15px; }
        .back-btn { color: var(--primary); cursor: pointer; display: block; margin-bottom: 10px; }
    </style>
</head>
<body>

<nav id="nav-title" onclick="showHome()">Echo's Threads</nav>

<div class="container">
    <div id="profile-view">
        <span class="back-btn" onclick="showHome()">â† è¿”å›ä¸»é¡µ</span>
        <h2 id="profile-name">æ­£åœ¨åŠ è½½...</h2>
        <p style="color: #536471;">è¿™æ˜¯è¯¥ç”¨æˆ·çš„ä¸ªäººè¶³è¿¹</p >
    </div>

    <div id="publish-area" class="input-box">
        <textarea id="t" placeholder="æœ‰ä»€ä¹ˆæ–°é²œäº‹ï¼Ÿ"></textarea>
        <div class="input-footer">
            <input type="text" id="nickname" placeholder="ä½ çš„æ˜µç§°">
            <button id="sendBtn" onclick="send()">å‘å¸ƒ</button>
        </div>
    </div>

    <div id="list"></div>
</div>

<script>
    // é…ç½®ä¿¡æ¯
    const SUPABASE_URL = 'https://ovggmclsqmivmrrvlbpa.supabase.co';
    const SUPABASE_KEY = 'åœ¨è¿™é‡Œå¡«å…¥ä½ çš„é‚£ä¸²é•¿é•¿çš„ANON_KEY'; 
    const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let currentViewUser = null; // å½“å‰æŸ¥çœ‹çš„ç”¨æˆ·

    // åŠ è½½æ•°æ®
    async function load(username = null) {
        let query = client.from('posts').select('*, comments(*)').order('id', { ascending: false });
        
        if (username) {
            query = query.eq('user_name', username);
            document.getElementById('publish-area').style.display = 'none';
            document.getElementById('profile-view').style.display = 'block';
            document.getElementById('profile-name').innerText = username + " çš„ä¸»é¡µ";
        } else {
            document.getElementById('publish-area').style.display = 'block';
            document.getElementById('profile-view').style.display = 'none';
        }

        const { data, error } = await query;
        if (error) return console.error(error);

        const list = document.getElementById('list');
        list.innerHTML = data.map(p => `
            <div class="post">
                <div class="post-header">
                    ${p.user_name || 'åŒ¿å'}
                    <span class="time">${new Date(p.created_at).toLocaleString()}</span>
                </div>
                <div class="content">${p.content}</div>
                <div class="actions">
                    <div class="action-btn" onclick="like(${p.id}, ${p.likes})">â¤ï¸ ${p.likes || 0}</div>
                    <div class="action-btn">ğŸ’¬ ${(p.comments || []).length}</div>
                </div>
                
                <div class="comments-section">
                    ${(p.comments || []).map(c => `
                        <div class="comment-item">
                            <strong style="color:#576b95">${c.user_name}:</strong> ${c.content}
                        </div>
                    `).join('')}
                    <div class="comment-input-wrap">
                        <input type="text" class="comment-input" placeholder="å›å¤..." 
                               onkeypress="if(event.key==='Enter') addComment(${p.id}, this)">
                    </div>
                </div>
            </div>
        `).join('');
    }

    // å‘å¸ƒåŠ¨æ€
    async function send() {
        const btn = document.getElementById('sendBtn');
        const name = document.getElementById('nickname').value || 'åŒ¿å';
        const val = document.getElementById('t').value;

        if (!val) return;
        btn.disabled = true;

        const { error } = await client.from('posts').insert([{ 
            content: val, 
            user_name: name, 
            likes: 0 
        }]);

        if (error) {
            alert("å‘å¸ƒå¤±è´¥: " + error.message);
        } else {
            document.getElementById('t').value = "";
            load();
        }
        btn.disabled = false;
    }

    // ç‚¹èµ
    async function like(id, curr) {
        await client.from('posts').update({ likes: (curr || 0) + 1 }).eq('id', id);
        load(currentViewUser);
    }

    // è¯„è®º
    async function addComment(postId, input) {
        const name = document.getElementById('nickname').value || 'åŒ¿å';
        if (!input.value) return;
        await client.from('comments').insert([{ post_id: postId, content: input.value, user_name: name }]);
        input.value = "";
        load(currentViewUser);
    }

    // è·¯ç”±åˆ‡æ¢
    function showProfile(username) {
        currentViewUser = username;
        load(username);
        window.scrollTo(0,0);
    }

    function showHome() {
        currentViewUser = null;
        load();
    }

    // åˆå§‹åŒ–
    load();
</script>

</body>
</html>












