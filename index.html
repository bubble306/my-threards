// 在发帖的逻辑 send() 函数里，确保这部分是对应的：
async function send() {
    const name = document.getElementById('nickname').value || '匿名';
    const val = document.getElementById('t').value;
    const file = document.getElementById('fileInput').files[0];
    let imgUrl = null;

    if (!val && !file) return;

    if (file) {
        const fileName = Date.now() + '-' + file.name;
        // 把图片上传到 images 桶
        const { data, error } = await client.storage.from('images').upload(fileName, file);
        if (error) { alert("上传失败：" + error.message); return; }
        
        // 获取图片的公开链接
        const { data: { publicUrl } } = client.storage.from('images').getPublicUrl(fileName);
        imgUrl = publicUrl;
    }

    // 存入数据库
    await client.from('posts').insert([{ 
        content: val, 
        user_name: name, 
        likes: 0, 
        image_url: imgUrl 
    }]);
    
    location.reload(); // 刷新页面看新贴
}

// 在显示帖子的 innerHTML 里面，别忘了加这一行来显示图片：
// ${p.image_url ? `< img src="${p.image_url}" style="width:100%; border-radius:10px; margin-top:10px;">` : ''}




