<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Echo's Threads - äº’åŠ¨ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .box { background: white; padding: 20px; border-radius: 15px; width: 100%; max-width: 450px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input, textarea { width: 100%; border: 1px solid #ddd; border-radius: 8px; padding: 10px; box-sizing: border-box; margin-bottom: 10px; font-size: 14px; }
        button { background: #000; color: #fff; border: none; padding: 12px; border-radius: 25px; cursor: pointer; width: 100%; font-weight: bold; }
        .post { background: white; padding: 15px; border-radius: 15px; margin-top: 15px; width: 100%; max-width: 450px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .user-tag { color: #1d9bf0; font-weight: bold; }
        .post-content { margin: 10px 0; font-size: 16px; white-space: pre-wrap; }
        .actions { display: flex; gap: 20px; border-top: 1px solid #f0f0f0; padding-top: 10px; color: #666; font-size: 14px; }
        .action-item { cursor: pointer; display: flex; align-items: center; gap: 5px; transition: 0.2s; }
        .action-item:hover { color: #e0245e; }
        .comment-section { background: #f8f9fa; padding: 10px; border-radius: 10px; margin-top: 10px; font-size: 13px; }
        .cmt-item { margin-bottom: 5px; border-bottom: 1px dashed #eee; padding-bottom: 3px; }
    </style>
</head>
<body>
    <div class="box">
        <input type="text" id="nickname" placeholder="è¾“å…¥ä½ çš„æ˜µç§° (æ¯”å¦‚: Echo)">
        <textarea id="t" rows="3" placeholder="ä»Šå¤©æœ‰ä»€ä¹ˆæ–°é²œäº‹ï¼Ÿ"></textarea>
        <button onclick="send()">å‘å¸ƒè´´å­</button>
    </div>
    <div id="list" style="width: 100%; max-width: 450px;">æ­£åœ¨åŠ è½½åŠ¨æ€...</div>

    <script>
        const SB_URL = "https://fzxucsdptrikazqvdnlv.supabase.co";
        const SB_KEY = "è¿™é‡Œæ›¿æ¢ä¸ºä½ é‚£ä¸²é•¿é•¿çš„eyJå¼€å¤´çš„Key";
        const client = supabase.createClient(SB_URL, SB_KEY);

        async function load() {
            // 1. è·å–æ‰€æœ‰å¸–å­
            const { data: posts, error } = await client.from('posts').select('*').order('created_at', { ascending: false });
            if (error) return console.error(error);

            const list = document.getElementById('list');
            list.innerHTML = "";
            
            for (let p of posts) {
                // 2. è·å–è¯¥è´´å¯¹åº”çš„è¯„è®º
                const { data: cms } = await client.from('comments').select('*').eq('post_id', p.id);
                
                const d = document.createElement('div');
                d.className = 'post';
                d.innerHTML = `
                    <div class="user-tag">@${p.user_name || 'åŒ¿åç”¨æˆ·'}</div>
                    <p class="post-content">${p.content}</p >
                    <div class="actions">
                        <div class="action-item" onclick="like(${p.id}, ${p.likes || 0})">â¤ï¸ ${p.likes || 0}</div>
                        <div class="action-item">ğŸ’¬ ${cms ? cms.length : 0}</div>
                    </div>
                    <div class="comment-section">
                        <div id="cmt-list-${p.id}">
                            ${cms ? cms.map(c => `<div class="cmt-item"><b>${c.user_name}:</b> ${c.content}</div>`).join('') : ''}
                        </div>
                        <input type="text" placeholder="å†™è¯„è®ºå¹¶å›è½¦..." style="margin-top:8px; padding:5px;" 
                               onkeydown="if(event.keyCode==13) addComment(${p.id}, this)">
                    </div>
                `;
                list.appendChild(d);
            }
        }

        async function send() {
            const name = document.getElementById('nickname').value || 'åŒ¿å';
            const val = document.getElementById('t').value;
            if(!val) return;
            await client.from('posts').insert([{ content: val, user_name: name, likes: 0 }]);
            document.getElementById('t').value = "";
            load();
        }

        async function like(id, curr) {
            await client.from('posts').update({ likes: curr + 1 }).eq('id', id);
            load();
        }

        async function addComment(postId, input) {
            const name = document.getElementById('nickname').value || 'åŒ¿å';
            const text = input.value;
            if(!text) return;
            await client.from('comments').insert([{ post_id: postId, content: text, user_name: name }]);
            input.value = "";
            load();
        }

        load();
    </script>
</body>
</html>













