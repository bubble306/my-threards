<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Echo's Threads - å…¨çƒåŒæ­¥ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { width: 100%; max-width: 500px; }
        .input-box { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        textarea { width: 100%; border: 1px solid #ddd; border-radius: 10px; padding: 10px; box-sizing: border-box; resize: none; outline: none; }
        .btn { background: #000; color: #fff; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; float: right; margin-top: 10px; font-weight: bold; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 15px; position: relative; }
        .user { font-weight: bold; color: #1c1e21; }
        .content { margin: 10px 0; color: #333; line-height: 1.5; white-space: pre-wrap; }
        .time { font-size: 12px; color: #90949c; }
        .actions { border-top: 1px solid #eee; padding-top: 10px; margin-top: 10px; display: flex; gap: 20px; }
        .action-item { cursor: pointer; font-size: 18px; }
    </style>
</head>
<body>

    <div class="container">
        <div class="input-box">
            <textarea id="postInput" rows="3" placeholder="Echoï¼Œä»Šå¤©æƒ³èŠç‚¹ä»€ä¹ˆï¼Ÿ"></textarea>
            <button class="btn" onclick="publish()">å‘å¸ƒ</button>
            <div style="clear:both;"></div>
        </div>
        <div id="postList">åŠ è½½ä¸­...</div>
    </div>

    <script>
        // 1. è¿æ¥ä½ çš„äº‘ç«¯å¤§è„‘
        const SB_URL = "https://fzxucsdptrikazqvdnlv.supabase.co";
        const SB_KEY = "Sb_publishable_YsUp5SFO5fnLwpC9J11mZw_4T0PZTaj"; // è¿™æ˜¯ä½ ç»™æˆ‘çš„ Key
        const supabase = supabase.createClient(SB_URL, SB_KEY);

        // 2. é¡µé¢æ‰“å¼€æ—¶ï¼Œå»äº‘ç«¯æŠ“å–æ‰€æœ‰è´´å­
        async function fetchPosts() {
            const { data, error } = await supabase
                .from('posts')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                console.error(error);
                document.getElementById('postList').innerHTML = "æ•°æ®åº“è¡¨è¿˜æ²¡å»ºå¥½å“¦ï¼";
                return;
            }

            const list = document.getElementById('postList');
            list.innerHTML = "";
            data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <div class="user">@${item.user_name || 'åŒ¿åç”¨æˆ·'}</div>
                    <div class="time">${new Date(item.created_at).toLocaleString()}</div>
                    <p class="content">${item.content}</p >
                    <div class="actions">
                        <span class="action-item">ğŸ¤</span>
                        <span class="action-item" onclick="alert('è¯„è®ºåŠŸèƒ½éœ€è¦å†å»ºä¸€å¼ commentè¡¨ï¼Œæƒ³å­¦å—ï¼Ÿ')">ğŸ’¬</span>
                        <span class="action-item">âœˆï¸</span>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        // 3. å‘å¸ƒæ–°è´´å­åˆ°äº‘ç«¯
        async function publish() {
            const content = document.getElementById('postInput').value;
            if (!content) return;

            const { error } = await supabase
                .from('posts')
                .insert([{ content: content, user_name: 'Echo' }]);

            if (error) {
                alert("å‘å¸ƒå¤±è´¥ï¼Œè¯·æ£€æŸ¥Supabaseé‡Œæ˜¯å¦å»ºäº†åä¸º posts çš„è¡¨ï¼");
            } else {
                document.getElementById('postInput').value = "";
                fetchPosts(); // åˆ·æ–°åˆ—è¡¨
            }
        }

        // åˆå§‹åŠ è½½
        fetchPosts();
    </script>
</body>
</html>
