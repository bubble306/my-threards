<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Echo's Threads</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .box { background: white; padding: 20px; border-radius: 15px; width: 100%; max-width: 400px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        textarea { width: 100%; border: 1px solid #ddd; border-radius: 10px; padding: 10px; box-sizing: border-box; }
        button { background: #000; color: #fff; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; margin-top: 10px; width: 100%; }
        .post { background: white; padding: 15px; border-radius: 10px; margin-top: 10px; width: 100%; max-width: 400px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>
    <div class="box">
        <textarea id="t" rows="3" placeholder="说点什么..."></textarea>
        <button onclick="send()">发布</button>
    </div>
    <div id="list">正在连接数据库...</div>

    <script>
        const SB_URL = "https://fzxucsdptrikazqvdnlv.supabase.co";
        const SB_KEY = "Sb_publishable_YsUp5SFO5fnLwpC9J11mZw_4T0PZTaj";
        
        // 初始化
        const client = supabase.createClient(SB_URL, SB_KEY);

        async function load() {
            const { data, error } = await client.from('posts').select('*').order('created_at', { ascending: false });
            if (error) {
                document.getElementById('list').innerHTML = "出错了：" + error.message;
            } else {
                document.getElementById('list').innerHTML = data.length === 0 ? "还没人发帖，快抢沙发！" : "";
                data.forEach(p => {
                    const d = document.createElement('div');
                    d.className = 'post';
                    d.innerHTML = `<b>@Echo</b><p>${p.content}</p >`;
                    document.getElementById('list').appendChild(d);
                });
            }
        }

        async function send() {
            const val = document.getElementById('t').value;
            if(!val) return;
            const { error } = await client.from('posts').insert([{ content: val, user_name: 'Echo' }]);
            if (error) alert("发帖失败：" + error.message);
            else { document.getElementById('t').value = ""; load(); }
        }

        load();
    </script>
</body>
</html>

